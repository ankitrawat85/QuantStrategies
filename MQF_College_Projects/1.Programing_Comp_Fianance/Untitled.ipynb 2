{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import matplotlib.pyplot as plt\n",
    "%matplotlib inline\n",
    "import warnings\n",
    "plt.style.use('seaborn')\n",
    "# plt.style.use('seaborn-colorblind') #alternative\n",
    "plt.rcParams['figure.figsize'] = [10, 8]\n",
    "plt.rcParams['figure.dpi'] = 300\n",
    "warnings.simplefilter(action='ignore', category=FutureWarning)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "## Implementing CAPM \n",
    "RISKY_ASSET = 'AMZN'\n",
    "MARKET_BENCHMARK = 'SPY'\n",
    "RISK_FREE = '^IRX'\n",
    "START_DATE = '2016-01-01'\n",
    "END_DATE = '2020-10-01'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [],
   "source": [
    "import yfinance as yf\n",
    "df = yf.download([RISKY_ASSET, MARKET_BENCHMARK, RISK_FREE], start=START_DATE, end=END_DATE, adjusted=True, progress=False)\n",
    "df_ = df[\"Adj Close\"].pct_change().resample('M').last().dropna()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>AMZN</th>\n",
       "      <th>SPY</th>\n",
       "      <th>^IRX</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Date</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2016-01-31</th>\n",
       "      <td>-0.076100</td>\n",
       "      <td>0.024377</td>\n",
       "      <td>-0.056604</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-02-29</th>\n",
       "      <td>-0.004881</td>\n",
       "      <td>-0.007843</td>\n",
       "      <td>0.016502</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-03-31</th>\n",
       "      <td>-0.008435</td>\n",
       "      <td>-0.002427</td>\n",
       "      <td>0.043243</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-04-30</th>\n",
       "      <td>0.095664</td>\n",
       "      <td>-0.005399</td>\n",
       "      <td>-0.080952</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-05-31</th>\n",
       "      <td>0.014812</td>\n",
       "      <td>-0.001903</td>\n",
       "      <td>-0.050336</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-06-30</th>\n",
       "      <td>0.000028</td>\n",
       "      <td>0.013646</td>\n",
       "      <td>-0.027451</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-07-31</th>\n",
       "      <td>0.008238</td>\n",
       "      <td>0.001615</td>\n",
       "      <td>0.090909</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-08-31</th>\n",
       "      <td>0.002058</td>\n",
       "      <td>-0.002844</td>\n",
       "      <td>-0.015385</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-09-30</th>\n",
       "      <td>0.009963</td>\n",
       "      <td>0.007546</td>\n",
       "      <td>0.106383</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-10-31</th>\n",
       "      <td>0.017390</td>\n",
       "      <td>0.000047</td>\n",
       "      <td>0.080586</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-11-30</th>\n",
       "      <td>-0.015672</td>\n",
       "      <td>-0.002399</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-12-31</th>\n",
       "      <td>-0.019970</td>\n",
       "      <td>-0.003655</td>\n",
       "      <td>0.090909</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-01-31</th>\n",
       "      <td>-0.008309</td>\n",
       "      <td>-0.000088</td>\n",
       "      <td>0.010101</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-02-28</th>\n",
       "      <td>-0.004242</td>\n",
       "      <td>-0.002699</td>\n",
       "      <td>0.067347</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-03-31</th>\n",
       "      <td>0.011639</td>\n",
       "      <td>-0.002328</td>\n",
       "      <td>-0.026385</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-04-30</th>\n",
       "      <td>0.007197</td>\n",
       "      <td>-0.002179</td>\n",
       "      <td>-0.006369</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-05-31</th>\n",
       "      <td>-0.002087</td>\n",
       "      <td>-0.000248</td>\n",
       "      <td>0.043956</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-06-30</th>\n",
       "      <td>-0.008126</td>\n",
       "      <td>0.001864</td>\n",
       "      <td>-0.009970</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-07-31</th>\n",
       "      <td>-0.031626</td>\n",
       "      <td>-0.000567</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-08-31</th>\n",
       "      <td>0.013446</td>\n",
       "      <td>0.006016</td>\n",
       "      <td>-0.020040</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-09-30</th>\n",
       "      <td>0.005176</td>\n",
       "      <td>0.003515</td>\n",
       "      <td>-0.001942</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-10-31</th>\n",
       "      <td>-0.005014</td>\n",
       "      <td>0.001558</td>\n",
       "      <td>0.044651</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-11-30</th>\n",
       "      <td>0.013330</td>\n",
       "      <td>0.008755</td>\n",
       "      <td>-0.015898</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-12-31</th>\n",
       "      <td>-0.014021</td>\n",
       "      <td>-0.003771</td>\n",
       "      <td>-0.010949</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-01-31</th>\n",
       "      <td>0.009090</td>\n",
       "      <td>0.000497</td>\n",
       "      <td>0.003509</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-02-28</th>\n",
       "      <td>0.000311</td>\n",
       "      <td>-0.010130</td>\n",
       "      <td>-0.010398</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-03-31</th>\n",
       "      <td>0.011122</td>\n",
       "      <td>0.012778</td>\n",
       "      <td>-0.014749</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-04-30</th>\n",
       "      <td>-0.004127</td>\n",
       "      <td>-0.007691</td>\n",
       "      <td>-0.003955</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-05-31</th>\n",
       "      <td>0.002911</td>\n",
       "      <td>-0.006126</td>\n",
       "      <td>-0.004260</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-06-30</th>\n",
       "      <td>-0.000970</td>\n",
       "      <td>0.001440</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-07-31</th>\n",
       "      <td>-0.001000</td>\n",
       "      <td>0.004929</td>\n",
       "      <td>0.020566</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-08-31</th>\n",
       "      <td>0.005159</td>\n",
       "      <td>0.000034</td>\n",
       "      <td>-0.001458</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-09-30</th>\n",
       "      <td>-0.004958</td>\n",
       "      <td>0.000103</td>\n",
       "      <td>0.004673</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-10-31</th>\n",
       "      <td>0.044164</td>\n",
       "      <td>0.010681</td>\n",
       "      <td>-0.002190</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-11-30</th>\n",
       "      <td>0.009919</td>\n",
       "      <td>0.006095</td>\n",
       "      <td>-0.000866</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-12-31</th>\n",
       "      <td>0.016204</td>\n",
       "      <td>0.008759</td>\n",
       "      <td>-0.012028</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-01-31</th>\n",
       "      <td>0.028915</td>\n",
       "      <td>0.008782</td>\n",
       "      <td>-0.010571</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-02-28</th>\n",
       "      <td>-0.000768</td>\n",
       "      <td>-0.001863</td>\n",
       "      <td>-0.004179</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-03-31</th>\n",
       "      <td>0.004133</td>\n",
       "      <td>0.006306</td>\n",
       "      <td>-0.017721</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-04-30</th>\n",
       "      <td>-0.006144</td>\n",
       "      <td>0.000510</td>\n",
       "      <td>0.003390</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-05-31</th>\n",
       "      <td>-0.022711</td>\n",
       "      <td>-0.013475</td>\n",
       "      <td>-0.007359</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-06-30</th>\n",
       "      <td>-0.005593</td>\n",
       "      <td>0.005146</td>\n",
       "      <td>-0.023981</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-07-31</th>\n",
       "      <td>-0.016723</td>\n",
       "      <td>-0.010940</td>\n",
       "      <td>-0.004902</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-08-31</th>\n",
       "      <td>-0.005659</td>\n",
       "      <td>-0.000444</td>\n",
       "      <td>-0.003608</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-09-30</th>\n",
       "      <td>0.006062</td>\n",
       "      <td>0.004638</td>\n",
       "      <td>0.023121</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-10-31</th>\n",
       "      <td>-0.001871</td>\n",
       "      <td>-0.002663</td>\n",
       "      <td>-0.060815</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-11-30</th>\n",
       "      <td>-0.009739</td>\n",
       "      <td>-0.003709</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-12-31</th>\n",
       "      <td>0.000514</td>\n",
       "      <td>0.002429</td>\n",
       "      <td>0.010067</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-01-31</th>\n",
       "      <td>0.073791</td>\n",
       "      <td>-0.018158</td>\n",
       "      <td>-0.011780</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-02-29</th>\n",
       "      <td>-0.000292</td>\n",
       "      <td>-0.004202</td>\n",
       "      <td>-0.118280</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-03-31</th>\n",
       "      <td>-0.007246</td>\n",
       "      <td>-0.014905</td>\n",
       "      <td>1.307692</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-04-30</th>\n",
       "      <td>0.042690</td>\n",
       "      <td>-0.009311</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-05-31</th>\n",
       "      <td>0.017188</td>\n",
       "      <td>0.004456</td>\n",
       "      <td>-0.072464</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-06-30</th>\n",
       "      <td>0.029265</td>\n",
       "      <td>0.012810</td>\n",
       "      <td>0.080000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-07-31</th>\n",
       "      <td>0.036961</td>\n",
       "      <td>0.007902</td>\n",
       "      <td>-0.023529</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-08-31</th>\n",
       "      <td>0.014451</td>\n",
       "      <td>-0.003623</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-09-30</th>\n",
       "      <td>0.001224</td>\n",
       "      <td>0.007582</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                AMZN       SPY      ^IRX\n",
       "Date                                    \n",
       "2016-01-31 -0.076100  0.024377 -0.056604\n",
       "2016-02-29 -0.004881 -0.007843  0.016502\n",
       "2016-03-31 -0.008435 -0.002427  0.043243\n",
       "2016-04-30  0.095664 -0.005399 -0.080952\n",
       "2016-05-31  0.014812 -0.001903 -0.050336\n",
       "2016-06-30  0.000028  0.013646 -0.027451\n",
       "2016-07-31  0.008238  0.001615  0.090909\n",
       "2016-08-31  0.002058 -0.002844 -0.015385\n",
       "2016-09-30  0.009963  0.007546  0.106383\n",
       "2016-10-31  0.017390  0.000047  0.080586\n",
       "2016-11-30 -0.015672 -0.002399  0.000000\n",
       "2016-12-31 -0.019970 -0.003655  0.090909\n",
       "2017-01-31 -0.008309 -0.000088  0.010101\n",
       "2017-02-28 -0.004242 -0.002699  0.067347\n",
       "2017-03-31  0.011639 -0.002328 -0.026385\n",
       "2017-04-30  0.007197 -0.002179 -0.006369\n",
       "2017-05-31 -0.002087 -0.000248  0.043956\n",
       "2017-06-30 -0.008126  0.001864 -0.009970\n",
       "2017-07-31 -0.031626 -0.000567  0.000000\n",
       "2017-08-31  0.013446  0.006016 -0.020040\n",
       "2017-09-30  0.005176  0.003515 -0.001942\n",
       "2017-10-31 -0.005014  0.001558  0.044651\n",
       "2017-11-30  0.013330  0.008755 -0.015898\n",
       "2017-12-31 -0.014021 -0.003771 -0.010949\n",
       "2018-01-31  0.009090  0.000497  0.003509\n",
       "2018-02-28  0.000311 -0.010130 -0.010398\n",
       "2018-03-31  0.011122  0.012778 -0.014749\n",
       "2018-04-30 -0.004127 -0.007691 -0.003955\n",
       "2018-05-31  0.002911 -0.006126 -0.004260\n",
       "2018-06-30 -0.000970  0.001440  0.000000\n",
       "2018-07-31 -0.001000  0.004929  0.020566\n",
       "2018-08-31  0.005159  0.000034 -0.001458\n",
       "2018-09-30 -0.004958  0.000103  0.004673\n",
       "2018-10-31  0.044164  0.010681 -0.002190\n",
       "2018-11-30  0.009919  0.006095 -0.000866\n",
       "2018-12-31  0.016204  0.008759 -0.012028\n",
       "2019-01-31  0.028915  0.008782 -0.010571\n",
       "2019-02-28 -0.000768 -0.001863 -0.004179\n",
       "2019-03-31  0.004133  0.006306 -0.017721\n",
       "2019-04-30 -0.006144  0.000510  0.003390\n",
       "2019-05-31 -0.022711 -0.013475 -0.007359\n",
       "2019-06-30 -0.005593  0.005146 -0.023981\n",
       "2019-07-31 -0.016723 -0.010940 -0.004902\n",
       "2019-08-31 -0.005659 -0.000444 -0.003608\n",
       "2019-09-30  0.006062  0.004638  0.023121\n",
       "2019-10-31 -0.001871 -0.002663 -0.060815\n",
       "2019-11-30 -0.009739 -0.003709  0.000000\n",
       "2019-12-31  0.000514  0.002429  0.010067\n",
       "2020-01-31  0.073791 -0.018158 -0.011780\n",
       "2020-02-29 -0.000292 -0.004202 -0.118280\n",
       "2020-03-31 -0.007246 -0.014905  1.307692\n",
       "2020-04-30  0.042690 -0.009311  0.000000\n",
       "2020-05-31  0.017188  0.004456 -0.072464\n",
       "2020-06-30  0.029265  0.012810  0.080000\n",
       "2020-07-31  0.036961  0.007902 -0.023529\n",
       "2020-08-31  0.014451 -0.003623  0.000000\n",
       "2020-09-30  0.001224  0.007582  0.000000"
      ]
     },
     "execution_count": 34,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "0.000024 / df_[\"SPY\"].var()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "metadata": {
    "collapsed": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>AMZN</th>\n",
       "      <th>SPY</th>\n",
       "      <th>^IRX</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Date</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2016-01-31</th>\n",
       "      <td>-0.076100</td>\n",
       "      <td>0.024377</td>\n",
       "      <td>-0.056604</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-02-29</th>\n",
       "      <td>-0.004881</td>\n",
       "      <td>-0.007843</td>\n",
       "      <td>0.016502</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-03-31</th>\n",
       "      <td>-0.008435</td>\n",
       "      <td>-0.002427</td>\n",
       "      <td>0.043243</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-04-30</th>\n",
       "      <td>0.095664</td>\n",
       "      <td>-0.005399</td>\n",
       "      <td>-0.080952</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-05-31</th>\n",
       "      <td>0.014812</td>\n",
       "      <td>-0.001903</td>\n",
       "      <td>-0.050336</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-06-30</th>\n",
       "      <td>0.000028</td>\n",
       "      <td>0.013646</td>\n",
       "      <td>-0.027451</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-07-31</th>\n",
       "      <td>0.008238</td>\n",
       "      <td>0.001615</td>\n",
       "      <td>0.090909</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-08-31</th>\n",
       "      <td>0.002058</td>\n",
       "      <td>-0.002844</td>\n",
       "      <td>-0.015385</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-09-30</th>\n",
       "      <td>0.009963</td>\n",
       "      <td>0.007546</td>\n",
       "      <td>0.106383</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-10-31</th>\n",
       "      <td>0.017390</td>\n",
       "      <td>0.000047</td>\n",
       "      <td>0.080586</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-11-30</th>\n",
       "      <td>-0.015672</td>\n",
       "      <td>-0.002399</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-12-31</th>\n",
       "      <td>-0.019970</td>\n",
       "      <td>-0.003655</td>\n",
       "      <td>0.090909</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-01-31</th>\n",
       "      <td>-0.008309</td>\n",
       "      <td>-0.000088</td>\n",
       "      <td>0.010101</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-02-28</th>\n",
       "      <td>-0.004242</td>\n",
       "      <td>-0.002699</td>\n",
       "      <td>0.067347</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-03-31</th>\n",
       "      <td>0.011639</td>\n",
       "      <td>-0.002328</td>\n",
       "      <td>-0.026385</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-04-30</th>\n",
       "      <td>0.007197</td>\n",
       "      <td>-0.002179</td>\n",
       "      <td>-0.006369</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-05-31</th>\n",
       "      <td>-0.002087</td>\n",
       "      <td>-0.000248</td>\n",
       "      <td>0.043956</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-06-30</th>\n",
       "      <td>-0.008126</td>\n",
       "      <td>0.001864</td>\n",
       "      <td>-0.009970</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-07-31</th>\n",
       "      <td>-0.031626</td>\n",
       "      <td>-0.000567</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-08-31</th>\n",
       "      <td>0.013446</td>\n",
       "      <td>0.006016</td>\n",
       "      <td>-0.020040</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-09-30</th>\n",
       "      <td>0.005176</td>\n",
       "      <td>0.003515</td>\n",
       "      <td>-0.001942</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-10-31</th>\n",
       "      <td>-0.005014</td>\n",
       "      <td>0.001558</td>\n",
       "      <td>0.044651</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-11-30</th>\n",
       "      <td>0.013330</td>\n",
       "      <td>0.008755</td>\n",
       "      <td>-0.015898</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017-12-31</th>\n",
       "      <td>-0.014021</td>\n",
       "      <td>-0.003771</td>\n",
       "      <td>-0.010949</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-01-31</th>\n",
       "      <td>0.009090</td>\n",
       "      <td>0.000497</td>\n",
       "      <td>0.003509</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-02-28</th>\n",
       "      <td>0.000311</td>\n",
       "      <td>-0.010130</td>\n",
       "      <td>-0.010398</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-03-31</th>\n",
       "      <td>0.011122</td>\n",
       "      <td>0.012778</td>\n",
       "      <td>-0.014749</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-04-30</th>\n",
       "      <td>-0.004127</td>\n",
       "      <td>-0.007691</td>\n",
       "      <td>-0.003955</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-05-31</th>\n",
       "      <td>0.002911</td>\n",
       "      <td>-0.006126</td>\n",
       "      <td>-0.004260</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-06-30</th>\n",
       "      <td>-0.000970</td>\n",
       "      <td>0.001440</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-07-31</th>\n",
       "      <td>-0.001000</td>\n",
       "      <td>0.004929</td>\n",
       "      <td>0.020566</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-08-31</th>\n",
       "      <td>0.005159</td>\n",
       "      <td>0.000034</td>\n",
       "      <td>-0.001458</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-09-30</th>\n",
       "      <td>-0.004958</td>\n",
       "      <td>0.000103</td>\n",
       "      <td>0.004673</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-10-31</th>\n",
       "      <td>0.044164</td>\n",
       "      <td>0.010681</td>\n",
       "      <td>-0.002190</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-11-30</th>\n",
       "      <td>0.009919</td>\n",
       "      <td>0.006095</td>\n",
       "      <td>-0.000866</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-12-31</th>\n",
       "      <td>0.016204</td>\n",
       "      <td>0.008759</td>\n",
       "      <td>-0.012028</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-01-31</th>\n",
       "      <td>0.028915</td>\n",
       "      <td>0.008782</td>\n",
       "      <td>-0.010571</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-02-28</th>\n",
       "      <td>-0.000768</td>\n",
       "      <td>-0.001863</td>\n",
       "      <td>-0.004179</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-03-31</th>\n",
       "      <td>0.004133</td>\n",
       "      <td>0.006306</td>\n",
       "      <td>-0.017721</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-04-30</th>\n",
       "      <td>-0.006144</td>\n",
       "      <td>0.000510</td>\n",
       "      <td>0.003390</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-05-31</th>\n",
       "      <td>-0.022711</td>\n",
       "      <td>-0.013475</td>\n",
       "      <td>-0.007359</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-06-30</th>\n",
       "      <td>-0.005593</td>\n",
       "      <td>0.005146</td>\n",
       "      <td>-0.023981</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-07-31</th>\n",
       "      <td>-0.016723</td>\n",
       "      <td>-0.010940</td>\n",
       "      <td>-0.004902</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-08-31</th>\n",
       "      <td>-0.005659</td>\n",
       "      <td>-0.000444</td>\n",
       "      <td>-0.003608</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-09-30</th>\n",
       "      <td>0.006062</td>\n",
       "      <td>0.004638</td>\n",
       "      <td>0.023121</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-10-31</th>\n",
       "      <td>-0.001871</td>\n",
       "      <td>-0.002663</td>\n",
       "      <td>-0.060815</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-11-30</th>\n",
       "      <td>-0.009739</td>\n",
       "      <td>-0.003709</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-12-31</th>\n",
       "      <td>0.000514</td>\n",
       "      <td>0.002429</td>\n",
       "      <td>0.010067</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-01-31</th>\n",
       "      <td>0.073791</td>\n",
       "      <td>-0.018158</td>\n",
       "      <td>-0.011780</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-02-29</th>\n",
       "      <td>-0.000292</td>\n",
       "      <td>-0.004202</td>\n",
       "      <td>-0.118280</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-03-31</th>\n",
       "      <td>-0.007246</td>\n",
       "      <td>-0.014905</td>\n",
       "      <td>1.307692</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-04-30</th>\n",
       "      <td>0.042690</td>\n",
       "      <td>-0.009311</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-05-31</th>\n",
       "      <td>0.017188</td>\n",
       "      <td>0.004456</td>\n",
       "      <td>-0.072464</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-06-30</th>\n",
       "      <td>0.029265</td>\n",
       "      <td>0.012810</td>\n",
       "      <td>0.080000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-07-31</th>\n",
       "      <td>0.036961</td>\n",
       "      <td>0.007902</td>\n",
       "      <td>-0.023529</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-08-31</th>\n",
       "      <td>0.014451</td>\n",
       "      <td>-0.003623</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-09-30</th>\n",
       "      <td>0.001224</td>\n",
       "      <td>0.007582</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                AMZN       SPY      ^IRX\n",
       "Date                                    \n",
       "2016-01-31 -0.076100  0.024377 -0.056604\n",
       "2016-02-29 -0.004881 -0.007843  0.016502\n",
       "2016-03-31 -0.008435 -0.002427  0.043243\n",
       "2016-04-30  0.095664 -0.005399 -0.080952\n",
       "2016-05-31  0.014812 -0.001903 -0.050336\n",
       "2016-06-30  0.000028  0.013646 -0.027451\n",
       "2016-07-31  0.008238  0.001615  0.090909\n",
       "2016-08-31  0.002058 -0.002844 -0.015385\n",
       "2016-09-30  0.009963  0.007546  0.106383\n",
       "2016-10-31  0.017390  0.000047  0.080586\n",
       "2016-11-30 -0.015672 -0.002399  0.000000\n",
       "2016-12-31 -0.019970 -0.003655  0.090909\n",
       "2017-01-31 -0.008309 -0.000088  0.010101\n",
       "2017-02-28 -0.004242 -0.002699  0.067347\n",
       "2017-03-31  0.011639 -0.002328 -0.026385\n",
       "2017-04-30  0.007197 -0.002179 -0.006369\n",
       "2017-05-31 -0.002087 -0.000248  0.043956\n",
       "2017-06-30 -0.008126  0.001864 -0.009970\n",
       "2017-07-31 -0.031626 -0.000567  0.000000\n",
       "2017-08-31  0.013446  0.006016 -0.020040\n",
       "2017-09-30  0.005176  0.003515 -0.001942\n",
       "2017-10-31 -0.005014  0.001558  0.044651\n",
       "2017-11-30  0.013330  0.008755 -0.015898\n",
       "2017-12-31 -0.014021 -0.003771 -0.010949\n",
       "2018-01-31  0.009090  0.000497  0.003509\n",
       "2018-02-28  0.000311 -0.010130 -0.010398\n",
       "2018-03-31  0.011122  0.012778 -0.014749\n",
       "2018-04-30 -0.004127 -0.007691 -0.003955\n",
       "2018-05-31  0.002911 -0.006126 -0.004260\n",
       "2018-06-30 -0.000970  0.001440  0.000000\n",
       "2018-07-31 -0.001000  0.004929  0.020566\n",
       "2018-08-31  0.005159  0.000034 -0.001458\n",
       "2018-09-30 -0.004958  0.000103  0.004673\n",
       "2018-10-31  0.044164  0.010681 -0.002190\n",
       "2018-11-30  0.009919  0.006095 -0.000866\n",
       "2018-12-31  0.016204  0.008759 -0.012028\n",
       "2019-01-31  0.028915  0.008782 -0.010571\n",
       "2019-02-28 -0.000768 -0.001863 -0.004179\n",
       "2019-03-31  0.004133  0.006306 -0.017721\n",
       "2019-04-30 -0.006144  0.000510  0.003390\n",
       "2019-05-31 -0.022711 -0.013475 -0.007359\n",
       "2019-06-30 -0.005593  0.005146 -0.023981\n",
       "2019-07-31 -0.016723 -0.010940 -0.004902\n",
       "2019-08-31 -0.005659 -0.000444 -0.003608\n",
       "2019-09-30  0.006062  0.004638  0.023121\n",
       "2019-10-31 -0.001871 -0.002663 -0.060815\n",
       "2019-11-30 -0.009739 -0.003709  0.000000\n",
       "2019-12-31  0.000514  0.002429  0.010067\n",
       "2020-01-31  0.073791 -0.018158 -0.011780\n",
       "2020-02-29 -0.000292 -0.004202 -0.118280\n",
       "2020-03-31 -0.007246 -0.014905  1.307692\n",
       "2020-04-30  0.042690 -0.009311  0.000000\n",
       "2020-05-31  0.017188  0.004456 -0.072464\n",
       "2020-06-30  0.029265  0.012810  0.080000\n",
       "2020-07-31  0.036961  0.007902 -0.023529\n",
       "2020-08-31  0.014451 -0.003623  0.000000\n",
       "2020-09-30  0.001224  0.007582  0.000000"
      ]
     },
     "execution_count": 35,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 40,
   "metadata": {},
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "import pandas as pd\n",
    "import statsmodels.api as sm\n",
    "import pandas_datareader.data as web\n",
    "import pandas_datareader as pdr\n",
    "c = df_[\"SPY\"]\n",
    "c = df_[\"SPY\"].add_constant()\n",
    "capm_model = sm.OLS(df_[\"AMZN\"], df_[\"SPY\"]).fit()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<table class=\"simpletable\">\n",
       "<caption>OLS Regression Results</caption>\n",
       "<tr>\n",
       "  <th>Dep. Variable:</th>          <td>AMZN</td>       <th>  R-squared (uncentered):</th>      <td>   0.014</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared (uncentered):</th> <td>  -0.004</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th>          <td>  0.7790</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Date:</th>             <td>Thu, 26 Nov 2020</td> <th>  Prob (F-statistic):</th>           <td> 0.381</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Time:</th>                 <td>10:05:19</td>     <th>  Log-Likelihood:    </th>          <td>  132.08</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>No. Observations:</th>      <td>    57</td>      <th>  AIC:               </th>          <td>  -262.2</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Df Residuals:</th>          <td>    56</td>      <th>  BIC:               </th>          <td>  -260.1</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>              <td> </td>   \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>              <td> </td>   \n",
       "</tr>\n",
       "</table>\n",
       "<table class=\"simpletable\">\n",
       "<tr>\n",
       "   <td></td>      <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>SPY</th> <td>   -0.3743</td> <td>    0.424</td> <td>   -0.883</td> <td> 0.381</td> <td>   -1.224</td> <td>    0.475</td>\n",
       "</tr>\n",
       "</table>\n",
       "<table class=\"simpletable\">\n",
       "<tr>\n",
       "  <th>Omnibus:</th>       <td>18.395</td> <th>  Durbin-Watson:     </th> <td>   1.543</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td>  42.568</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Skew:</th>          <td> 0.865</td> <th>  Prob(JB):          </th> <td>5.71e-10</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Kurtosis:</th>      <td> 6.864</td> <th>  Cond. No.          </th> <td>    1.00</td>\n",
       "</tr>\n",
       "</table><br/><br/>Warnings:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified."
      ],
      "text/plain": [
       "<class 'statsmodels.iolib.summary.Summary'>\n",
       "\"\"\"\n",
       "                                 OLS Regression Results                                \n",
       "=======================================================================================\n",
       "Dep. Variable:                   AMZN   R-squared (uncentered):                   0.014\n",
       "Model:                            OLS   Adj. R-squared (uncentered):             -0.004\n",
       "Method:                 Least Squares   F-statistic:                             0.7790\n",
       "Date:                Thu, 26 Nov 2020   Prob (F-statistic):                       0.381\n",
       "Time:                        10:05:19   Log-Likelihood:                          132.08\n",
       "No. Observations:                  57   AIC:                                     -262.2\n",
       "Df Residuals:                      56   BIC:                                     -260.1\n",
       "Df Model:                           1                                                  \n",
       "Covariance Type:            nonrobust                                                  \n",
       "==============================================================================\n",
       "                 coef    std err          t      P>|t|      [0.025      0.975]\n",
       "------------------------------------------------------------------------------\n",
       "SPY           -0.3743      0.424     -0.883      0.381      -1.224       0.475\n",
       "==============================================================================\n",
       "Omnibus:                       18.395   Durbin-Watson:                   1.543\n",
       "Prob(Omnibus):                  0.000   Jarque-Bera (JB):               42.568\n",
       "Skew:                           0.865   Prob(JB):                     5.71e-10\n",
       "Kurtosis:                       6.864   Cond. No.                         1.00\n",
       "==============================================================================\n",
       "\n",
       "Warnings:\n",
       "[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.\n",
       "\"\"\""
      ]
     },
     "execution_count": 39,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "capm_model.summary()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 41,
   "metadata": {},
   "outputs": [],
   "source": [
    "##Fema French Model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 42,
   "metadata": {},
   "outputs": [],
   "source": [
    "import statsmodels.formula.api as smf"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "metadata": {},
   "outputs": [],
   "source": [
    "RISKY_ASSET = 'FB'\n",
    "START_DATE = '2013-12-31'\n",
    "END_DATE = '2020-10-01'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 56,
   "metadata": {},
   "outputs": [],
   "source": [
    "# load data from csv\n",
    "factor_df = pd.read_csv('F-F_Research_Data_Factors.csv', skiprows=3)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 57,
   "metadata": {},
   "outputs": [],
   "source": [
    "# identify where the annual data starts\n",
    "STR_TO_MATCH = ' Annual Factors: January-December '\n",
    "indices = factor_df.iloc[:, 0] == STR_TO_MATCH\n",
    "start_of_annual = factor_df[indices].index[0]\n",
    "# keep only monthly data\n",
    "factor_df = factor_df[factor_df.index < start_of_annual]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 59,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Unnamed: 0</th>\n",
       "      <th>Mkt-RF</th>\n",
       "      <th>SMB</th>\n",
       "      <th>HML</th>\n",
       "      <th>RF</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>192607</td>\n",
       "      <td>2.96</td>\n",
       "      <td>-2.30</td>\n",
       "      <td>-2.87</td>\n",
       "      <td>0.22</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>192608</td>\n",
       "      <td>2.64</td>\n",
       "      <td>-1.40</td>\n",
       "      <td>4.19</td>\n",
       "      <td>0.25</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>192609</td>\n",
       "      <td>0.36</td>\n",
       "      <td>-1.32</td>\n",
       "      <td>0.01</td>\n",
       "      <td>0.23</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>192610</td>\n",
       "      <td>-3.24</td>\n",
       "      <td>0.04</td>\n",
       "      <td>0.51</td>\n",
       "      <td>0.32</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>192611</td>\n",
       "      <td>2.53</td>\n",
       "      <td>-0.20</td>\n",
       "      <td>-0.35</td>\n",
       "      <td>0.31</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1116</th>\n",
       "      <td>201907</td>\n",
       "      <td>1.19</td>\n",
       "      <td>-2.07</td>\n",
       "      <td>0.14</td>\n",
       "      <td>0.19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1117</th>\n",
       "      <td>201908</td>\n",
       "      <td>-2.58</td>\n",
       "      <td>-2.41</td>\n",
       "      <td>-4.99</td>\n",
       "      <td>0.16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1118</th>\n",
       "      <td>201909</td>\n",
       "      <td>1.44</td>\n",
       "      <td>-0.90</td>\n",
       "      <td>6.71</td>\n",
       "      <td>0.18</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1119</th>\n",
       "      <td>201910</td>\n",
       "      <td>2.06</td>\n",
       "      <td>0.25</td>\n",
       "      <td>-2.07</td>\n",
       "      <td>0.15</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1120</th>\n",
       "      <td>201911</td>\n",
       "      <td>3.87</td>\n",
       "      <td>0.86</td>\n",
       "      <td>-1.88</td>\n",
       "      <td>0.12</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>1121 rows Ã— 5 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "     Unnamed: 0    Mkt-RF       SMB       HML        RF\n",
       "0        192607      2.96     -2.30     -2.87      0.22\n",
       "1        192608      2.64     -1.40      4.19      0.25\n",
       "2        192609      0.36     -1.32      0.01      0.23\n",
       "3        192610     -3.24      0.04      0.51      0.32\n",
       "4        192611      2.53     -0.20     -0.35      0.31\n",
       "...         ...       ...       ...       ...       ...\n",
       "1116     201907      1.19     -2.07      0.14      0.19\n",
       "1117     201908     -2.58     -2.41     -4.99      0.16\n",
       "1118     201909      1.44     -0.90      6.71      0.18\n",
       "1119     201910      2.06      0.25     -2.07      0.15\n",
       "1120     201911      3.87      0.86     -1.88      0.12\n",
       "\n",
       "[1121 rows x 5 columns]"
      ]
     },
     "execution_count": 59,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "factor_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 53,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/Users/ankitrawat/opt/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:7: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  import sys\n"
     ]
    }
   ],
   "source": [
    "# rename columns\n",
    "factor_df.columns = ['date', 'mkt', 'smb', 'hml', 'rf']\n",
    "\n",
    "# convert strings to datetime\n",
    "factor_df['date'] = pd.to_datetime(factor_df['date'], \n",
    "                                   format='%Y%m') \\\n",
    "                      .dt.strftime(\"%Y-%m\")\n",
    "\n",
    "# set index\n",
    "factor_df = factor_df.set_index('date')\n",
    "\n",
    "# filter only required dates\n",
    "factor_df = factor_df.loc[START_DATE:END_DATE]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 63,
   "metadata": {},
   "outputs": [],
   "source": [
    "factor_df.rename(columns = {\"Unnamed: 0\" : \"Date\"},inplace  = True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 74,
   "metadata": {},
   "outputs": [],
   "source": [
    "factor_df[\"Date\"] = pd.to_datetime(factor_df[\"Date\"],format = '%Y%M').dt.strftime(\"%Y-%M\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 78,
   "metadata": {},
   "outputs": [],
   "source": [
    "factor_df = factor_df.set_index(\"Date\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 80,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Mkt-RF</th>\n",
       "      <th>SMB</th>\n",
       "      <th>HML</th>\n",
       "      <th>RF</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Date</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1926-07</th>\n",
       "      <td>2.96</td>\n",
       "      <td>-2.30</td>\n",
       "      <td>-2.87</td>\n",
       "      <td>0.22</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1926-08</th>\n",
       "      <td>2.64</td>\n",
       "      <td>-1.40</td>\n",
       "      <td>4.19</td>\n",
       "      <td>0.25</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1926-09</th>\n",
       "      <td>0.36</td>\n",
       "      <td>-1.32</td>\n",
       "      <td>0.01</td>\n",
       "      <td>0.23</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1926-10</th>\n",
       "      <td>-3.24</td>\n",
       "      <td>0.04</td>\n",
       "      <td>0.51</td>\n",
       "      <td>0.32</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1926-11</th>\n",
       "      <td>2.53</td>\n",
       "      <td>-0.20</td>\n",
       "      <td>-0.35</td>\n",
       "      <td>0.31</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "           Mkt-RF       SMB       HML        RF\n",
       "Date                                           \n",
       "1926-07      2.96     -2.30     -2.87      0.22\n",
       "1926-08      2.64     -1.40      4.19      0.25\n",
       "1926-09      0.36     -1.32      0.01      0.23\n",
       "1926-10     -3.24      0.04      0.51      0.32\n",
       "1926-11      2.53     -0.20     -0.35      0.31"
      ]
     },
     "execution_count": 80,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "factor_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
